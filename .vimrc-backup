"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
"
" This file is free software configuration code: you can redistribute it
" and/or modify it under the terms of the GNU General Public License as
" published by the Free Software Foundation, version 3..
"
" This configuration is distributed in the hope that it will be useful,
" but WITHOUT ANY WARRANTY; without even the implied warranty of
" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
" GNU General Public License for more details.
"
" You should have received a copy of the GNU General Public License
" along with this configure rile.  If not, see <http://www.gnu.org/licenses/>.
"
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

"""""""""    ~/.vimrc índice     """"""""""""""""""""""""""""""""""""""""""""""
"
"   0) Carregando plugins em ~/.vim/bundle/{nome-do-plugin}
"   1) Definição de funções auxiliares
"   2) Configurações gerais
"   3) Interface do vim
"   4) Cores e fontes
"   5) Textos e tabulações
"   6) Linha de status
"   7) Desfazer persistente
"   8) Carrega o plugins
"   9) Configurações específicas para HTML
"   10) Mapeamento de teclas
"   11) Outras configurações
"
"""""""""""""""""""""""      ~/.vimrc índice     """"""""""""""""""""""""""""""

"""""""""  0) Carregando plugins em ~/.vim/bundle/{nome-do-plugin} """""""""""

" Utiliza o pathogen para modificar facilmente o caminho em tempo de
" execução para incluir todos os plugins no diretório ~/.vim/bundle 
call pathogen#helptags()
call pathogen#infect()

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

""""""""""  1) Definição de funções auxiliares  """""""""""""""""""""""""""""""

" Retorna verdadeiro se o modo de copiar e colar estiver ativado
function! HasPaste()
    if &paste
        return 'PASTE MODE ON'
    endif
    return 'PASTE MODE OFF'
endfunction

" Abre URL no browse
function! Browser()
    let line = getline(".")
    let line = matchstr(line, "http[^   ]*")
    exec "!firefox ".line
endfunction

" Rotação de temas
let themeindex = 0
function! RotateColorTheme()
    let y = -1
    while y == -1
        let colorstring ="candy#github#inkpot#mustang#codeschool#grb256#metacosm#molokai#"
        let x = match(colorstring, "#", g:themeindex)
        let y = match(colorstring, "#", x+1)
        let g:themeindex = x + 1
        if y == -1
            let g:themeindex = 0
        else
            let themestring = strpart(colorstring, x + 1, y - x -1)
            return ":colorscheme ".themestring
        endif
    endwhile
endfunction

" Modo TodoList
function! TodoListMode()
    e ~/.todo.otl
    Calendar
    wincmd l
    set foldlevel=1
    tabnew ~/.notes.txt
    tabfirst
    " ou 'norm! zMzr'
endfunction

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

""""""""""  2) Configurações gerais """""""""""""""""""""""""""""""""""""""""""

" Usa as definições do vim, não as do vi
set nocompatible

" Desativa o backup e swapfile, encoranjando o usuário a utilizar técnicas
" atuais como Git e SVN para armazenamento do código
set nobackup
set noswapfile
set nowb

" Esconde o buffers ativos ao invés de fechá-los, permite que você tenha
" alterações não salvas em um arquivo e abrir um novo arquivo sem ser 
" forçado a salvar ou desfazer alterações antes
set hidden

" Configura a codificação de caracteres e o idioma
set encoding=utf8
"language en_US

" Define o tamanho do histórico de comandos do vim:
set history=1000

" Altera q quantidade de desfazer permitido
set undolevels=1000

" Habilita o reconhecimento de arquivos
filetype on
filetype plugin on
filetype indent on
set grepprg=grep\ -nH\ $*

" Recarrega o arquivo caso ele seja editado por um programa externo,
" enquanto aberto
set autoread

" Habilita o uso do mouse no vim para cliques e coisas do tipo
set mouse=a

" Altera o mapleader de '\' para ','
let mapleader=","
let g:mapleader=","

" Enfatizar alguns caracteres de maneira conveniente
set list
set listchars=tab:>.,trail:.,extends:#,nbsp:.,precedes:<,extends:>

" Alterna teporariamente para "paste mode", evitando identação desnecessária
" ao colar
set pastetoggle=<F2>

" Testes
set completeopt=longest,menuone,preview

" Não executa redraw quando estiver executando macros
set nolazyredraw

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

""""""""""  3) Interface do vim """""""""""""""""""""""""""""""""""""""""""""""

" Ativa o menu Wild (ativa o <Ctrl>n e <Ctrl>p para navegar entre as 
" correspondências da busca)
set wildmenu

" <Tab> percorre todas as opções disponíveis
set wildmode=list:longest,full

" Ignora arquivos de determinados tipos
set wildignore=*.swp,*.bak,*.pyc,*.class

" Sempre mostra a posição atual do cursor
set ruler

" Mostra a barra de comandos
set showcmd

" Altura da barra de comandos
set cmdheight=2

" Configurando a tecla <Backspace> para o que ela deve fazer
set backspace=eol,start,indent
set whichwrap+=<,>,h,l

" Destaca os resultados da busca
set hlsearch

" Mostra itens encontrados enquanto digita
set incsearch

" Habilita expressões regulares
set magic

" Destaca pares de colchetes ao passar o cursor e congirura o tempo do
" destaque em décimos de segundo
set showmatch
set mat=10

" Ignora case quando procurando
set ignorecase

" Ignora case se o padrão estiver todo em lowercase, do contrário
" case-sensitive
set smartcase

" Altera o título do terminal
set title

" Remove beep's
set visualbell
set noerrorbells
set tm=500

" Remove os blinks na tela
set vb t_vb=

" Faz uma margem no editor (colorcolumn)
set cc=80

" Marca as colunas excedentes com uma cor padrão
"let &colorcolumn=join(range(81,999), ",")
"highlight ColorColumn ctermbg=235 guibg=#ffa4a4

" Utiliza o inglês para checagem de ortografia, mas não a realiza como padrão
if version >= 700
    set spl=en spell
    set nospell
endif

set foldmethod=syntax
set foldlevelstart=99

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

""""""""""  4) Cores e fontes   """""""""""""""""""""""""""""""""""""""""""""""

" Ativa a numeração das linhas
set number

" Configura o número de cores do terminal para 256
set t_Co=256

" Pode ser necessário alterar a variável TERM para xterm-256color
" Esquema decores do vim
if &t_Co >= 256 || has("gui_running")
    " Configura o tema
    colorscheme candy

    " Remove barra de ferramentas
    set guioptions-=T
endif

" Habilita o destaque de sintaxe quando houver cor no terminal
if &t_Co > 2 || has("gui_running")
    syntax on
endif

" Desativa a quebra de linha automática
set nolinebreak

" Permite a navegação dentro de uma mesma linha longa com j e k
set wrap

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

""""""""""  5) Textos e tabulações  """""""""""""""""""""""""""""""""""""""""""

" Insere espaços no lugar de caracteres de tabulação
set expandtab

" Uso inteligente de tabulações
set smarttab

" Define uma tabulação com uma quantidade definida de espaços
set shiftwidth=4
set tabstop=4

" Usa múltiplos de shiftwidth quando identando com '<' e '>'
set shiftround

" Auto identar
set autoindent

" Copia a identação anterior em auto-identar
set copyindent

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

""""""""""  6) Linha de status  """""""""""""""""""""""""""""""""""""""""""""""

" Sempre mostra a linha de status
set laststatus=2

" Formato da linha de status
set statusline=%F%m%r%h%w\ (%{&ff}){%Y}\ [%l,%v][%p%%]

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

""""""""""  7) Desfazer persistente """""""""""""""""""""""""""""""""""""""""""

" Preserva o histórico do desfazer após o fim da sessão atual salvando-o
" em um arquivo
set undodir=~/.vim/undobackups
set undofile

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

""""""""""  8) Carrega o plugins    """""""""""""""""""""""""""""""""""""""""""

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

""""""""""  9) Configurações específicas do HTML    """""""""""""""""""""""""""

" Desativando tab's de listchars para arquivos xml/html
autocmd filetype html,xml set listchars-=tab:>.

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

""""""""""  10) Mapeamento de teclas    """""""""""""""""""""""""""""""""""""""

" Edita e recarrega o arquivo vimrc rapidamente
nmap <silent> <leader>ev :tabnew<CR>:e $MYVIMRC<CR>
nmap <silent> <leader>sv :tabnew<CR>:so $MYVIMRC<CR>

" Troca ; e :
nnoremap ; :

" Força o usuário a utilizar a navegação através de [hjkl]
map <up> <nop>
map <down> <nop>
map <left> <nop>
map <right> <nop>

" Remove incompatilidade de caracteres do DOS
nnoremap <silent> <F9> :%s/$//g<CR>:%s// /g<CR>

" Chama a função browser na linha ,w
map <leader>l :call Browser()<CR>

" Abre o plugin Project ,pal
nnoremap <silent> <leader>pal :Project .vimproject<CR>

" TODO Mode
nnoremap <silent> <leader>todo :execute TodoListMode()<CR>

" Abre o plugin TagList
nnoremap <silent> <F3> :Tlist<CR>

" Próxima aba
nnoremap <silent> <C-Right> :tabnext<CR>

" Aba anterior
nnoremap <silent> <C-Left> :tabprevious<CR>

" Nova aba
nnoremap <silent> <C-t> :tabnew<CR>

" Fechar aba atual
nnoremap <silent> <C-x> :tabclose<CR>

" Troca o esquema de cores utilizando a função RotateColorTheme()
nnoremap <silent> <F8> :execute RotateColorTheme()<CR>

" Toggle no diretório
nnoremap <space> za

" Altera o comportamento de navegação entre as linhas
nnoremap j gj
nnoremap k gk

" Configura navegação entre split como: <ctrl> + <[hjkl]>
nmap <silent> <c-k> :wincmd k<CR>
nmap <silent> <c-j> :wincmd j<CR>
nmap <silent> <c-h> :wincmd h<CR>
nmap <silent> <c-l> :wincmd l<CR>

" Ativa a funcionalidade inverse tab (<Shift> + <Tab>)
nmap <S-Tab> <<
imap <S-Tab> <Esc><<i

" Usando <Q> para formatar o parágrafo atual ou seleção
vmap Q gq
nmap Q gqap

" Limpando buscas anteriores
nmap <silent> ,/ :nohlsearch<CR>

" Salva arquivos como sudo
cmap w!! w !sudo tee % >/dev/null

" Cria nova linha e continua no modo Normal
nnoremap <silent> zj o<Esc>
nnoremap <silent> zk O<Esc>

" Foca o próximo item na busca
map N Nzz
map n nzz

" Salva alterações sem fechar o arquivo
map <leader>s :w!<CR>

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

""""""""""  11) Outras configurações    """""""""""""""""""""""""""""""""""""""

" Utiliza o compilador gcc como padrão
compiler gcc

" Configuração do plugin TagList
let Tlist_Use_Right_Window = 1
let Tlist_Enable_Fold_Column = 0
let Tlist_Exit_OnlyWindow = 1
let Tlist_Use_SingleClick = 1
let Tlist_Inc_WinWidth = 0

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
